<!DOCTYPE html><html lang=ja><!-- Copyright (c) 2014-2016 Kei Misawa This software is released under the MIT License. http://opensource.org/licenses/mit-license.php --><head><meta charset=utf-8 /><meta name=viewport content="width=device-width, initial-scale=1"/><title>Create GPX Route with Google Maps API v3</title><meta name=keywords content="Google,Maps,GPX,Route,Create,マップ,作成"/><meta name=description content="Create GPX file of routes with Google Maps API v3"/><meta name=author content=330k /><meta name=application-name content=GMapGPX /><meta name=mobile-web-app-capable content=no /><meta name=apple-mobile-web-app-capable content=no /><meta name=msapplication-TileColor content="#da532c"/><meta name=theme-color content="#ffffff"/><link rel=stylesheet href="//ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/themes/redmond/jquery-ui.css"/><link rel=apple-touch-icon sizes=57x57 href="apple-touch-icon-57x57.png"/><link rel=apple-touch-icon sizes=60x60 href="apple-touch-icon-60x60.png"/><link rel=apple-touch-icon sizes=72x72 href="apple-touch-icon-72x72.png"/><link rel=apple-touch-icon sizes=76x76 href="apple-touch-icon-76x76.png"/><link rel=apple-touch-icon sizes=114x114 href="apple-touch-icon-114x114.png"/><link rel=apple-touch-icon sizes=120x120 href="apple-touch-icon-120x120.png"/><link rel=icon type="image/png" href="favicon-32x32.png" sizes=32x32 /><link rel=icon type="image/png" href="favicon-96x96.png" sizes=96x96 /><link rel=icon type="image/png" href="favicon-16x16.png" sizes=16x16 /><link rel=manifest href="manifest.json"/><style type="text/css">html{height:100%}body{height:100%;margin:0;padding:0}#center_panel{position:absolute;right:0;top:0;width:70%;height:100%}#map_canvas{position:absolute;right:0;top:0;width:100%;height:80%}#graph_panel{position:absolute;right:0;top:80%;width:100%;height:20%;overflow:hidden}#graph_canvas{margin:1px}#side_panel{position:absolute;left:0;top:0;width:30%;min-width:200px;max-width:400px;height:100%;overflow:hidden}#accordion{font-size:80%}#tab_search input[type="text"]{width:100%}#tab_search input[type="submit"]{width:100%}#tab_search select{width:100%}#waypoints{list-style-type:none;margin:0;padding:0;width:100%}#waypoints li{position:relative}#tab_search div{position:relative}#tab_search span.ui-icon{position:absolute;right:0;top:0;bottom:0;width:16px;height:16px;margin:auto}#gpx_download_link{display:block;width:100%}#tab_gpx select{width:100%}#tab_gpx input[type="text"]{width:100%}#button_add_elevation{width:100%}#gpx_text{width:100%;height:80%;font-size:10px;overflow:auto}button.ui-dialog-titlebar-close{display:none}</style></head><body><div id=center_panel><div id=map_canvas></div><div id=graph_panel><div id=graph_canvas></div></div></div><div id=side_panel><div id=accordion><h3>Search</h3><div id=tab_search><form>Origin:<div><span id=set_current_position_as_origin class="ui-icon ui-icon-pin-s" title="Input current position from Geolocation API (Edge, Firefox)"></span><input id=input_origin type=text value="Tokyo Station"/></div><ul id=waypoints>Via:<li><span class="ui-icon ui-icon-arrowthick-2-n-s"></span><input type=text value=""/></li><li><span class="ui-icon ui-icon-arrowthick-2-n-s"></span><input type=text value=""/></li><li><span class="ui-icon ui-icon-arrowthick-2-n-s"></span><input type=text value=""/></li><li><span class="ui-icon ui-icon-arrowthick-2-n-s"></span><input type=text value=""/></li><li><span class="ui-icon ui-icon-arrowthick-2-n-s"></span><input type=text value=""/></li><li><span class="ui-icon ui-icon-arrowthick-2-n-s"></span><input type=text value=""/></li><li><span class="ui-icon ui-icon-arrowthick-2-n-s"></span><input type=text value=""/></li><li><span class="ui-icon ui-icon-arrowthick-2-n-s"></span><input type=text value=""/></li></ul>Destination:<div><span id=set_current_position_as_destination class="ui-icon ui-icon-pin-s" title="Input current position from Geolocation API (Edge, Firefox)"></span><input id=input_destination type=text value="Yokohama Station"/></div><div><label><input id=input_avoid_highways type=checkbox checked=checked value=""/>Avoid Highways</label></div><div><label><input id=input_avoid_tolls type=checkbox checked=checked value=""/>Avoid Tolls</label></div><div><label><input id=input_optimize_waypoints type=checkbox value=""/>Optimize waypoints</label></div><select id=select_travel_mode><option value=DRIVING selected=selected>Driving</option><option value=WALKING>Walking</option></select><input type=submit id=button_calc_route value="Calculate Route"/></form></div><h3>GPX</h3><div id=tab_gpx><div id=tab_gpx_001><span>GPX File Name:</span><input id=input_download_filename type=text value="download.gpx"/><a id=gpx_download_link>Download</a><select id=select_reduce_points><option value=100>100 points</option><option value=200>200 points</option><option value=400>400 points</option><option value=800>800 points</option><option value=2000>2000 points</option><option value=4000 selected=selected>4000 points</option><option value=8000>8000 points</option><option value=0>Full</option></select><button id=button_add_elevation>Add Elevation</button><div id=gpx_info></div></div><textarea id=gpx_text readonly=readonly wrap=off></textarea></div><h3>Directions</h3><div id=tab_directions><div id=directions_panel></div></div><h3>Usage</h3><div id=tab_usage><h4>Basics</h4><ul><li>Input origin and destination</li><li>Click "Calculate Route" button</li><li>Download GPX file by "Download GPX"</li></ul><h4>Route Modification</h4><ul><li>You can change origination, destination, and waypoints by drag and drop operation</li><li>Right click in map area, you can<ul><li>Set the clicked point as origin</li><li>Set the clicked point as destination</li><li>Clear all waypoints</li><li>Reverse origin and destination (waypoints order also reversed)</li></ul></ul><h4>Elevation</h4><ul><li>Click "Add Elevation" button if you need elevation data</li><li>Elevation data is shown in right bottom area</li><li>Elevation request rate is 100 points / sec to avoid limitations of Google Maps Elevation API</li></ul><h4>Waypoints Simplify</h4><ul><li>The number of waypoints is up to 4000 points by default</li><li>This limit can be changed by selecting option ("Full" means no reduction)</li><li>Ramer-Douglas-Peucker algorythm is used to reduce waypoints</li><li>Simplified line is shown by red one</li><li>Distance is calculated against simplified line</li></ul><a href="create_gpx_route_mobile.html">Mobile Edition</a></div></div></div><script src="//ajax.googleapis.com/ajax/libs/jquery/2.2.2/jquery.min.js"></script><script src="//ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/jquery-ui.min.js"></script><script src="//code.highcharts.com/highcharts.js"></script><script defer=defer>var map;var gpxdata={name:"",bounds:{minlat:0,minlon:0,maxlat:0,maxlon:0},desc:"",trksegs:[[]]};if(location.protocol=="http:"){location.replace(location.href.replace(/http:/,"https:"))}function initialize(){$("#accordion").accordion({heightStyle:"fill",animate:false,activate:function(c,d){$("#gpx_text").height($("#tab_gpx").innerHeight()-$("#tab_gpx_001").outerHeight()-$("#tab_gpx_001").position().top)}});$("#side_panel").resizable({handles:"e",resize:function(c,d){$("#center_panel").width($("body").innerWidth()-$("#side_panel").width());$("#graph_panel").resize()}}).resize(function(){if(typeof localStorage!=="undefined"){localStorage.setItem("side_panel_width",$("#side_panel").width())}});$("#graph_panel").resizable({handles:"n",resize:function(c,d){$("#map_canvas").height($("#center_panel").innerHeight()-$("#graph_panel").height())}}).resize(function(){$("#graph_canvas").highcharts().setSize($("#graph_panel").innerWidth(),$("#graph_panel").innerHeight());if(typeof localStorage!=="undefined"){localStorage.setItem("graph_panel_height",$("#graph_panel").height())}});$("#waypoints").sortable({}).disableSelection();$("#waypoints input").bind("click.sortable mousedown.sortable",function(c){c.target.focus()});$('<div id="dialog"></div>').dialog({modal:true,closeOnEscape:false,autoOpen:false,draggable:false,resizable:false});var a=new google.maps.Geocoder();$('#tab_search input[type="text"]').blur(function(){var c=$(this);if(c.val()!==""){a.geocode({address:c.val()},function(e,d){if(d===google.maps.GeocoderStatus.OK){c.removeClass("ui-state-error")}else{c.addClass("ui-state-error")}})}else{c.removeClass("ui-state-error")}});map=new google.maps.Map(document.getElementById("map_canvas"),{zoom:6,mapTypeId:google.maps.MapTypeId.ROADMAP,center:new google.maps.LatLng(35.681382,139.766084)});var b=new google.maps.DirectionsRenderer({draggable:true});b.setMap(map);b.setPanel(document.getElementById("directions_panel"));google.maps.event.addListener(b,"directions_changed",function(){createGPXFromDirections(b.directions);updateSearchConditions(b.directions);$("#accordion").accordion("option","active",1);$("#gpx_download_link").button("option","disabled",false);$("#select_reduce_points").removeAttr("disabled");$("#button_add_elevation").button("option","disabled",false)});$('<ul id="rmenu"><li><a id="rmenu_set_origin">Set this point as Origin</a></li><li><a id="rmenu_set_destination">Set this point as Destination</a></li><li><a id="rmenu_clear_waypoints">Clear all Waypoints</a></li><li><a id="rmenu_reverse_origin_destination">Reverse Origin and Destination</a></li></div>').appendTo($("body")).menu().css("position","absolute").hide();google.maps.event.addListener(map,"rightclick",function(c){(function(e,d){$("#rmenu_set_origin").off("click").click(function(f){f.preventDefault();$("#input_origin").val(e+","+d);$("#rmenu").hide();$("#accordion").accordion("option","active",0);if(typeof gpxdata.trksegs[0][0]!=="undefined"){calcRoute(b)}});$("#rmenu_set_destination").off("click").click(function(f){f.preventDefault();$("#input_destination").val(e+","+d);$("#rmenu").hide();$("#accordion").accordion("option","active",0);if(typeof gpxdata.trksegs[0][0]!=="undefined"){calcRoute(b)}});$("#rmenu_clear_waypoints").off("click").click(function(f){f.preventDefault();$("#waypoints input").each(function(){$(this).val("")});$("#rmenu").hide();if(typeof gpxdata.trksegs[0][0]!=="undefined"){calcRoute(b)}});$("#rmenu_reverse_origin_destination").off("click").click(function(h){var g,f=[];h.preventDefault();f.push($("#input_origin").val());$("#waypoints input").each(function(){f.push($(this).val())});f.push($("#input_destination").val());$("#input_origin").val(f.pop());$("#waypoints input").each(function(){$(this).val(f.pop())});$("#input_destination").val(f.pop());$("#rmenu").hide();if(typeof gpxdata.trksegs[0][0]!=="undefined"){calcRoute(b)}})})(c.latLng.lat().toFixed(5),c.latLng.lng().toFixed(5));$("#rmenu").css({left:c.pixel.x+$("#map_canvas").position().left+$("#center_panel").position().left,top:c.pixel.y+$("#map_canvas").position().top+$("#center_panel").position().top}).on("mouseleave",function(){setTimeout(function(){$("#rmenu").hide()},200)}).show()});google.maps.event.addListener(map,"click",function(c){$("#rmenu").hide()});if(navigator.geolocation){$("#set_current_position_as_origin").click(function(){navigator.geolocation.getCurrentPosition(function(c){$("#input_origin").val(c.coords.latitude+","+c.coords.longitude)},function(c){console.log(c)})});$("#set_current_position_as_destination").click(function(){navigator.geolocation.getCurrentPosition(function(c){$("#input_destination").val(c.coords.latitude+","+c.coords.longitude)},function(c){console.log(c)})})}else{$("#set_current_position_as_origin").hide();$("#set_current_position_as_destination").hide()}$("#button_calc_route").button().attr("title","calculate route").click(function(c){calcRoute(b);c.preventDefault()});$("#gpx_download_link").button({disabled:true}).attr("title","download gpx file to your PC");$("#select_reduce_points").attr("disabled","disabled").change(function(){simplifyGPX($("#select_reduce_points").val());createGPXDownloadLink()});$("#button_add_elevation").button({disabled:true}).click(function(){$("#dialog").html('<div id="dialog_message"></div><div id="dialog_progressbar"></div>').dialog({title:"Elevation Addition"}).dialog("open");$("#dialog_progressbar").progressbar({value:0});addElevationToGPX(function(c){if(c.state==="finished"){createGPXDownloadLink();$("#dialog").dialog("close")}else{$("#dialog_message").html(c.content);$("#dialog_progressbar").progressbar("option",{value:c.value,max:c.max})}})}).attr("title","add elevation to each trkpt element from Google Maps Elevation API");$("#graph_canvas").click(function(){$("#button_add_elevation").click()});$("#input_download_filename").change(function(){$("#gpx_download_link").attr("download",$(this).val())});createGPXDownloadLink()}function calcRoute(a){var d=[];$("#waypoints input").each(function(){if($(this).val()!==""){d.push({location:$(this).val(),stopover:$("#input_optimize_waypoints").prop("checked")})}});var b={origin:$("#input_origin").val(),destination:$("#input_destination").val(),travelMode:google.maps.TravelMode[$("#select_travel_mode").val()],avoidHighways:$("#input_avoid_highways").prop("checked"),avoidTolls:$("#input_avoid_tolls").prop("checked"),waypoints:d,optimizeWaypoints:$("#input_optimize_waypoints").prop("checked")};$("#dialog").dialog({title:"Route Calculation"}).html("calculating...").dialog("open");var c=new google.maps.DirectionsService();c.route(b,function(f,e){if(e===google.maps.DirectionsStatus.OK){a.setDirections(f);$("#dialog").dialog("close")}else{$("#dialog").html('<span class="ui-icon ui-icon-alert"></span>Route Not Found').dialog("option",{buttons:[{text:"OK",click:function(h,g){$(this).dialog("close");$(this).dialog("option",{buttons:[]})}}]})}})}function createGPXFromDirections(f){var n=f.routes[0];var a=n.bounds.toUrlValue().split(",");gpxdata.bounds.minlat=a[0];gpxdata.bounds.minlon=a[1];gpxdata.bounds.maxlat=a[2];gpxdata.bounds.maxlon=a[3];gpxdata.desc=n.copyrights;gpxdata.name=n.legs[0].start_address+" to "+n.legs[n.legs.length-1].end_address;gpxdata.trksegs=[[]];var c=540;var d=540;var b=gpxdata.trksegs[0];for(var h=0;h<n.legs.length;h++){for(var g=0;g<n.legs[h].steps.length;g++){for(var e=0;e<n.legs[h].steps[g].path.length;e++){var l=n.legs[h].steps[g].path[e].lat();var m=n.legs[h].steps[g].path[e].lng();if((l!==c)||(m!==d)){b.push({lat:l,lon:m,enabled:true,ele:null,priority:null});c=l;d=m}}}}simplifyGPX($("#select_reduce_points").val());createGPXDownloadLink()}function updateSearchConditions(b){var a=b.routes[0];$("#input_origin").val(a.legs[0].start_location.toUrlValue());$("#input_destination").val(a.legs[a.legs.length-1].end_location.toUrlValue());var d=[];for(var e=0;e<a.legs.length;e++){for(var c=0;c<a.legs[e].via_waypoints.length;c++){d.push(a.legs[e].via_waypoints[c].toUrlValue())}d.push(a.legs[e].end_location.toUrlValue())}d.pop();$("#waypoints input").each(function(){if(d.length>0){$(this).val(d.shift())}else{$(this).val("")}})}function createGPXDownloadLink(){try{var b=[];b.push('<?xml version="1.0" encoding="UTF-8"?>');b.push('<gpx version="1.0" creator="Create GPX Route with Google Maps API v3" xmlns="http://www.topografix.com/GPX/1/0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.topografix.com/GPX/1/0 http://www.topografix.com/GPX/1/0/gpx.xsd">');b.push("<desc>"+escapeXMLString(gpxdata.desc)+"</desc>");b.push("<url>http://www.330k.info/</url>");b.push('<bounds minlat="'+gpxdata.bounds.minlat+'" minlon="'+gpxdata.bounds.minlon+'" maxlat="'+gpxdata.bounds.maxlat+'" maxlon="'+gpxdata.bounds.maxlon+'" />');b.push("<trk>");b.push("<name>"+escapeXMLString(gpxdata.name)+"</name>");b.push("<trkseg>");var g=gpxdata.trksegs[0];for(var c=0;c<g.length;c++){if(g[c].enabled){b.push('<trkpt lat="'+g[c].lat.toFixed(5)+'" lon="'+g[c].lon.toFixed(5)+'">'+((g[c].ele!==null)?"<ele>"+g[c].ele.toFixed(2)+"</ele>":"")+"</trkpt>")}}b.push("</trkseg>");b.push("</trk>");b.push("</gpx>");var j=b.join("\n");$("#gpx_text").val(j);var f=document.getElementById("gpx_download_link");window.URL=window.URL||window.webkitURL;window.BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder;if(window.URL&&window.URL.createObjectURL){var a=null;try{a=new Blob([j],{type:"application/xml"})}catch(d){var h=new BlobBuilder();h.append(j);a=h.getBlob("application/xml")}f.href=window.URL.createObjectURL(a)}else{f.href="data:application/octet-stream,"+encodeURIComponent(j);f.setAttribute("target","_blank")}f.setAttribute("download",$("#input_download_filename").val());setTimeout(function(){var e=calcDistance();$("#gpx_info").html("<div>"+g.length+" points to "+e.points+" points</div><div>Total Distance: "+(e.total_distance*0.001).toFixed(3)+" km</div><div>Total Elevation: "+e.total_elevation.toFixed(2)+" m</div>")},0);setTimeout(function(){$("#graph_canvas").highcharts(createGraphData());$("#graph_canvas").highcharts().setSize($("#graph_panel").innerWidth(),$("#graph_panel").innerHeight());drawSimplifiedLine()},0)}catch(d){console.log(d)}}function escapeXMLString(b){var a=b;if(typeof a==="string"){a=a.replace("&","&amp;");a=a.replace(">","&gt;");a=a.replace("<","&lt;");a=a.replace('"',"&quot;");a=a.replace("'","&apos;")}else{a=""}return a}var calcDistance=(function(){var a=(function(){var d=6378137;var c=6356752.314245;var j=c*c/(d*d);var i=1-j;var h=Math.PI/180;var e=Math.sin;var g=Math.cos;var f=Math.sqrt;return function(q,s,o,r){var v=(q-o)*h;var x=(s-r)*h;var b=0.5*(q+o)*h;var t=e(b);var m=g(b);var p=1-t*t*i;var u=f(p);var l=d*j/(p*u);var k=d/u;return f(v*v*l*l+x*x*k*k*m*m)}})();return function(){var e=0;var g=0;var c=null;if(typeof gpxdata.trksegs[0][0]==="undefined"){return{points:0,total_distance:0,total_elevation:0}}var d=[];var f=gpxdata.trksegs[0];var b=0;for(b=0;b<f.length;b++){if(f[b].enabled){d.push(f[b])}}f[0].total_distance=0;for(b=1;b<d.length;b++){e+=a(d[b-1].lat,d[b-1].lon,d[b].lat,d[b].lon);if(d[b].ele!==null){if((c!==null)&&(d[b].ele>c)){g+=d[b].ele-c}c=d[b].ele}d[b].total_distance=e;d[b].total_elevation=g}return{points:d.length,total_distance:e,total_elevation:g}}})();var addElevationToGPX=(function(){var a=100;var b=1000;var e={};var d=null;if(typeof localStorage!=="undefined"){try{e=JSON.parse(localStorage.getItem("elecache"));if(e===null){e={}}}catch(f){}}function c(g,h){if(d===null){d=new google.maps.ElevationService()}d.getElevationForLocations({locations:g},h)}return function(q){var o=[];var n=0;var m=[];var h=gpxdata.trksegs[0];var l=0;for(l=0;l<h.length;l++){if((h[l].enabled)&&(h[l].ele===null)){var g=e[(new google.maps.LatLng(h[l].lat,h[l].lon)).toUrlValue()];if(g){h[l].ele=g-0}else{m.push(h[l])}}}var p=m.length;if(p===0){q({state:"finished",content:""});return}q({state:"processing",content:"requesting... ",max:p,value:0});for(var k=0;k<p;k+=a){o=[];for(l=k;(l<k+a)&&(l<p);l++){o.push(new google.maps.LatLng(m[l].lat,m[l].lon))}(function(r,i){setTimeout(function(){c(i,function(t,j){if(j===google.maps.ElevationStatus.OK){for(var s=0;s<t.length;s++){m[s+r].ele=t[s].elevation.toFixed(2)-0;e[t[s].location.toUrlValue()]=t[s].elevation.toFixed(2)}}else{console.log(j)}n+=i.length;try{localStorage.setItem("elecache",JSON.stringify(e))}catch(u){}if(n>=p){q({state:"finished",content:""})}else{q({state:"processing",content:"processing... "+n+"/"+p,max:p,value:n})}})},r*b/a)})(k,o)}q({state:"processing",content:"processing... "+0+"/"+p,max:p,value:0})}})();var simplifyGPX=(function(){var f=Math.PI/180;var d=Math.PI/4;function b(){if(typeof gpxdata.trksegs[0][0]==="undefined"){return}var n=[];var m=gpxdata.trksegs[0];for(var j=0;j<m.length;j++){n[j]=[m[j].lon*f,Math.log(Math.abs(Math.tan(d+0.5*m[j].lat*f)))]}var g=new a();var l=e(n,0,n.length-1);g.enqueue(l.dist,l);m[0].priority=1;m[n.length-1].priority=2;var k=2;while(g.size()){var h=g.dequeue();k++;if(h.pos>=0){m[h.pos].priority=k}if(h.start+2<=h.pos){l=e(n,h.start,h.pos);g.enqueue(l.dist,l)}if(h.pos+2<=h.end){l=e(n,h.pos,h.end);g.enqueue(l.dist,l)}}return}function e(r,h,k){var g=r[h][0];var s=r[h][1];var q=r[k][0];var o=r[k][1];var n=0;var j=-Number.MAX_VALUE;var p=-1;for(var l=h+1;l<k;l++){n=c(g,s,q,o,r[l][0],r[l][1]);if(j<n){j=n;p=l}}return{start:h,end:k,pos:p,dist:j}}function c(g,o,i,h,m,k){var n=(g*g+o*o+i*m-g*(i+m)+h*k-o*(h+k))/(g*g+o*o-2*g*i+i*i-2*o*h+h*h);if((0<=n)&&(n<=1)){var l=g-(g-i)*n;var j=o-(o-h)*n;return((l-m)*(l-m)+(j-k)*(j-k))}else{if(n>1){return((i-m)*(i-m)+(h-k)*(h-k))}else{return((g-m)*(g-m)+(o-k)*(o-k))}}}function a(){this.name="Pairing Heap";this._size=0;this._root=null;this._merge=function(k,h){if(k===null){return h}if(h===null){return k}if(k.p<h.p){var g=k;k=h;h=g}h.next=k.head;k.head=h;return k};this._mergeList=function(k){var l=null;while(k!==null){var h=k;var g=null;k=k.next;h.next=null;if(k!==null){g=k;k=k.next;g.next=null}h=this._merge(h,g);h.next=l;l=h}while(l!==null){var i=l;l=l.next;k=this._merge(i,k)}return k};this.enqueue=function(g,h){this._root=this._merge(this._root,{p:g,v:h,next:null,head:null});this._size++};this.dequeue=function(){var g=this._root.v;this._root=this._mergeList(this._root.head);this._size--;return g};this.size=function(){return this._size};return this}return function(g){var k=g||400;var j=gpxdata.trksegs[0];var h=0;for(h=0;h<j.length;h++){if(j[h].priority===null){b();break}}if(k<=0){for(h=0;h<j.length;h++){j[h].enabled=true}}else{for(h=0;h<j.length;h++){if(j[h].priority<=k){j[h].enabled=true}else{j[h].enabled=false}}}}})();var createGraphData=(function(){var a=null;return function(){var f=gpxdata.trksegs[0];var c={};var b=100;if(typeof f[0]!=="undefined"){b=f[f.length-1].total_distance*0.001}var e={chart:{type:"area",animation:false,zoomType:"x"},legend:{enabled:false},title:null,xAxis:{title:{text:"distance (km)"},gridLineWidth:1,lineColor:"#000",tickColor:"#000",min:0,max:b},yAxis:{title:{text:"evelation (m)"},gridLineWidth:1,lineColor:"#000",tickColor:"#000"},plotLines:[{value:0,width:4,color:"#808080"}],plotOptions:{series:{animation:false,marker:{enabled:false},allowPointSelect:true,point:{events:{mouseOver:function(){map.setCenter(c[this.x]);if(a.getMap()===null){a.setMap(map)}a.setPosition(c[this.x])}}},events:{mouseOut:function(){a.setMap(null)}}}},series:[{name:"evelation",data:[]}]};if(a===null){a=new google.maps.Marker({position:null,map:null})}for(var d=0;d<f.length;d++){if(f[d].enabled&&f[d].total_distance&&f[d].ele){var g=(f[d].total_distance*0.001).toFixed(3)-0;e.series[0].data.push([g,f[d].ele.toFixed(2)-0]);c[g]=new google.maps.LatLng(f[d].lat,f[d].lon)}}return e}})();var drawSimplifiedLine=(function(){var a=null;return function(){var c=[];var e=gpxdata.trksegs[0];var d=false;for(var b=0;b<e.length;b++){if(e[b].enabled){c.push(new google.maps.LatLng(e[b].lat,e[b].lon))}else{d=true}}if(d){if(a){a.setPath(c)}else{a=new google.maps.Polyline({path:c,strokeColor:"#FF0000",strokeOpacity:1,strokeWeight:2,zIndex:100,clickable:false,map:map})}}else{if(a){a.setMap(null)}a=null}}})();(function(d,e,j,h,f,c,b){d.GoogleAnalyticsObject=f;d[f]=d[f]||function(){(d[f].q=d[f].q||[]).push(arguments)},d[f].l=1*new Date();c=e.createElement(j),b=e.getElementsByTagName(j)[0];c.async=1;c.src=h;b.parentNode.insertBefore(c,b)})(window,document,"script","//www.google-analytics.com/analytics.js","ga");ga("create","UA-5655726-6","auto");ga("send","pageview");</script><script src="//maps.google.com/maps/api/js?key=AIzaSyAK_fsDPU922f1HHLlwJUiGi11XCgujJ4M&amp;callback=initialize"></script></body></html>